# Install Vector Database

We use Milvus under the hood as vector database implementation due to its high performance and robustness. We follow the Milvus instructions at [here](https://milvus.io/docs/install_standalone-docker-compose.md) to install Milvus **Standalone** Service on a `t2.medium` instance (the same one as we installed the keyword search service).
To be self-contained, we list the installation commands required in this doc.

## Configure Milvus

We include `milvus` directory in `denser-retriever` repo to support Milvus installation. Open the `milvus/standalone/docker-compose.yml` file and find the following block:
```shell
volumes:
  - /home/ubuntu/denser-retriever/milvus/standalone/milvus.yaml:/milvus/configs/milvus.yaml   # Map the local path to the container path
  - ${DOCKER_VOLUME_DIRECTORY:-/home/ubuntu/efs/milvus_data_retriever}/volumes/milvus:/var/lib/milvus
```

We need two modifications:
- Change the path of `/home/ubuntu/denser-retriever/milvus/standalone/milvus.yaml` to point to your correct `milvus.yaml` path
- Change the path of `/home/ubuntu/efs/milvus_data_retriever` to point to the location you wish to store the embeddings. This location should have sufficient storage space to store embeddings for a large collection of datasets.


## Start Milvus

Follow the instructions at [here](https://milvus.io/docs/install_standalone-docker-compose.md), we run the following command to start Milvus:

```shell
cd milvus/standalone
sudo docker compose up -d
```

## User Access Authentication

We follow the instructions at [here](https://milvus.io/docs/authenticate.md) to enable user access authentication. Specifically, we set `common.security.authorizationEnabled` in `milvus.yaml` as `true` when configuring Milvus.

A `root` user (password: `Milvus`) is created along with each Milvus instance by default. To prevent your milvus server from public access, you can edit the file `reset_password.py` to replace the `YOUR_PASSWORD` with your real password, and then run the following cmd to change. Take a note of your changed password as it would be required to access vector database.

```python
python reset_password.py
```

## Test Milvus

To test milvus connection and operators, we run the following command from any computers. It tests the connection to Milvus server, creating Milvus index, querying with Milvus index and finally deleting Milvus index.

```python
python hello_milvus.py
```

##  Stop Milvus

To stop the Milvus, you can simply run the following command under directory of `milvus/standalone`.

```shell
sudo docker compose stop
```




